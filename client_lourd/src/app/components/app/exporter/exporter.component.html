<div id="container">
    <mat-card>
        <mat-card-title>
            Exporter un dessin
        </mat-card-title>
        <mat-card-content>
            <mat-accordion>

                <!-- Destination panel -->
                <mat-expansion-panel hideToggle>
                    <mat-expansion-panel-header>
                        <mat-panel-title>Destination</mat-panel-title>
                        <mat-panel-description>Choisir la destination (defaut: local)</mat-panel-description>
                        <mat-icon>save_alt</mat-icon>
                    </mat-expansion-panel-header>
                    <mat-radio-group [(ngModel)]="selectedDestination">
                        <mat-radio-button value="local">Local</mat-radio-button>
                        <mat-radio-button value="email">Courriel</mat-radio-button>
                    </mat-radio-group>
                </mat-expansion-panel>

                <!-- Name panel -->
                <mat-expansion-panel hideToggle>
                    <mat-expansion-panel-header>
                        <mat-panel-title>Nom</mat-panel-title>
                        <mat-panel-description>Choisir le nom du fichier de sortie (defaut: SansTitre)</mat-panel-description>
                        <mat-icon>text_format</mat-icon>
                    </mat-expansion-panel-header>
                    <form class="example-form">
                        <mat-form-field>
                          <mat-label>Nom du fichier</mat-label>
                          <label>
                            <input [(ngModel)]="fileName" [ngModelOptions]="{standalone: true}" spellcheck="false" matInput placeholder="Ex. MonDessin">
                          </label>
                        </mat-form-field>
                    </form>
                </mat-expansion-panel>

                <!-- Format panel -->
                <mat-expansion-panel hideToggle>
                    <mat-expansion-panel-header>
                        <mat-panel-title>Format de sortie</mat-panel-title>
                        <mat-panel-description>Sélectionner le format (defaut: png)</mat-panel-description>
                        <mat-icon>image</mat-icon>
                    </mat-expansion-panel-header>
                    <mat-form-field>
                        <mat-label>Format</mat-label>
                        <mat-select [(value)]="selectedFormat">
                            <mat-option *ngFor="let format of formats" [value]="format.value">
                                {{format.viewValue}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </mat-expansion-panel>

                <!-- Filter panel -->
                <mat-expansion-panel hideToggle>
                    <mat-expansion-panel-header>
                        <mat-panel-title>Filtre</mat-panel-title>
                        <mat-panel-description>Appliquer un filtre de couleur (defaut: aucun)</mat-panel-description>
                        <mat-icon>color_lens</mat-icon>
                    </mat-expansion-panel-header>
                    <mat-form-field>
                        <mat-label>Format</mat-label>
                        <mat-select [(value)]="selectedFilter" (valueChange)="setFilter()">
                            <mat-option *ngFor="let filter of filters" [value]="filter.value">
                              {{filter.viewValue}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </mat-expansion-panel>

                <!-- Email panel -->
                <mat-expansion-panel *ngIf="selectedDestination === 'email'" hideToggle>
                    <mat-expansion-panel-header>
                        <mat-panel-title>Courriel</mat-panel-title>
                        <mat-panel-description>Choisir l'adresse courriel d'expédition (requis)</mat-panel-description>
                        <mat-icon>email</mat-icon>
                    </mat-expansion-panel-header>
                    <form class="example-form">
                        <mat-form-field>
                          <mat-label>Adresse courriel</mat-label>
                          <label>
                            <input type="email" (change)="validateEmail()" [(ngModel)]="email" [ngModelOptions]="{standalone: true}" matInput placeholder="Ex. monCourriel@courriel.com">
                          </label>
                        </mat-form-field>
                    </form>
                </mat-expansion-panel>
            </mat-accordion>
        </mat-card-content>
        <div *ngIf="displayAlertErr" class="alert error">
          <div class="alert-text">
            {{alert}}
          </div>
          <div class="alert-x" (click)="displayAlertErr = false">
            X
          </div>
        </div>

        <div *ngIf="displayAlertSucc" class="alert success">
          <div class="alert-text">
            {{alert}}
          </div>
          <div class="alert-x" (click)="displayAlertSucc = false">
            X
          </div>
        </div>
        <mat-card-subtitle>
          Prévisualisation
        </mat-card-subtitle>
        <mat-card-content>
          <canvas #canvas id="previewCanvas" width="200" height="200"></canvas>
        </mat-card-content>
        <mat-card-content>
            <button (click)="exportSvg()" mat-raised-button>Exporter</button>
            <a #download></a>
        </mat-card-content>
    </mat-card>
</div>

<svg #filterSvg xmlns="http://www.w3.org/2000/svg">
  <filter id="invert">
    <feComponentTransfer>
      <feFuncR type="table" tableValues="1 0"/>
      <feFuncG type="table" tableValues="1 0"/>
      <feFuncB type="table" tableValues="1 0"/>
    </feComponentTransfer>
  </filter>

  <filter id="opacity">
    <feComponentTransfer>
      <feFuncA type="table" tableValues="0 0.5"/>
    </feComponentTransfer>
  </filter>

  <filter id="brightnessIncrease">
    <feComponentTransfer>
      <feFuncR type="linear" slope="1.5"/>
      <feFuncG type="linear" slope="1.5"/>
      <feFuncB type="linear" slope="1.5"/>
    </feComponentTransfer>
  </filter>

  <filter id="brightnessDecrease">
    <feComponentTransfer>
      <feFuncR type="linear" slope="0.5"/>
      <feFuncG type="linear" slope="0.5"/>
      <feFuncB type="linear" slope="0.5"/>
    </feComponentTransfer>
  </filter>

  <filter id="grayscale">
    <feColorMatrix type="matrix" values="0.3333 0.3333 0.3333 0.0000
                                         0.0000 0.3333 0.3333 0.3333
                                         0.0000 0.0000 0.3333 0.3333
                                         0.3333 0.0000 0.0000 0.0000
                                         0.0000 0.0000 1.0000 0.0000"/>
  </filter>

  <g #exportGRef id="gElement"></g>
</svg>

<canvas #exportCanvas [hidden]="true"></canvas>
